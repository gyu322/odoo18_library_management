<?xml version="1.0" encoding="UTF-8"?>

<odoo>
    <!-- List view of library.book model (start)-->
    <record id="library_book_list_view" model="ir.ui.view">
        <field name="name">Library Book List View</field>
        <field name="model">library.book</field>
        <field name="arch" type="xml">
            <list decoration-danger="available_copies == 0">
                <field name="title"/>
                <field name="author"/>
                <field name="isbn"/>
                <field name="category" widget="badge"
                       decoration-info="category == 'fiction'"
                       decoration-success="category == 'science'"
                       decoration-warning="category == 'history'"
                       decoration-primary="category == 'technology'"/>
                <field name="total_copies"/>
                <field name="available_copies"/>
                <field name="publication_year"/>
                <field name="publisher"/>
            </list>
        </field>
    </record>
    <!-- List view of library.book model (end)-->

    <!-- Form view of library.book model (start)-->
    <record id="library_book_form_view" model="ir.ui.view">
        <field name="name">Library Book Form View</field>
        <field name="model">library.book</field>
        <field name="arch" type="xml">
            <form>
                <header>
                    <button name="action_view_borrowing_records" string="View Borrowing Records" type="object" class="btn-primary"/>
                </header>
                <sheet>
                    <field name="image" widget="image" class="oe_avatar"/>

                    <div class="oe_title">
                        <h1>
                            <field name="title"/>
                        </h1>
                        <h3>
                            by
                            <field name="author" class="oe_inline"/>
                        </h3>
                    </div>

                    <group>
                        <group>
                            <field name="isbn"/>
                            <field name="category"/>
                            <field name="active"/>
                        </group>
                        <group>
                            <label for="total_copies" string="Inventory"/>
                            <div class="o_row">
                                <field name="available_copies"/>
                                /
                                <field name="total_copies"/>
                                copies
                            </div>
                            <field name="publication_year"/>
                            <field name="publisher"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Description">
                            <field name="description" placeholder="Enter book description, summary, or notes..."/>
                        </page>

                        <page string="Borrowing History">
                            <field name="borrowing_record_ids">
                                <list>
                                    <field name="sequence"/>
                                    <field name="member_name"/>
                                    <field name="borrow_date"/>
                                    <field name="expected_return_date"/>
                                    <field name="actual_return_date"/>
                                    <field name="status" widget="badge"/>
                                    <field name="fine_amount"/>
                                    <button name="action_return_book" type="object" string="Return"
                                            class="btn-primary btn-sm" invisible="status not in ['borrowed', 'overdue']"/>
                                </list>
                            </field>
                        </page>
                    </notebook>
                </sheet>
            </form>
        </field>
    </record>
    <!-- Form view of library.book model (end)-->

    <!-- Kanban view of library.book model (start)-->
    <record id="library_book_kanban_view" model="ir.ui.view">
        <field name="name">Library Book Kanban View</field>
        <field name="model">library.book</field>
        <field name="arch" type="xml">
            <kanban>
                <field name="id"/>
                <field name="title"/>
                <field name="author"/>
                <field name="category"/>
                <field name="available_copies"/>
                <field name="total_copies"/>
                <field name="image"/>
                <templates>
                    <t t-name="kanban-box">
                        <div class="oe_kanban_card oe_kanban_global_click"
                             style="width: 250px; height: 380px; display: flex; flex-direction: column;">
                            <!-- Image at the top center -->
                            <div class="o_kanban_image" style="text-align: center; padding: 10px;width: 100%; height: 190px; overflow: hidden; flex-shrink: 0;">
                                <img t-att-src="kanban_image('library.book', 'image', record.id.raw_value)"
                                     alt="Book Cover"
                                     style="width: 100%; height: 100%; object-fit: cover; border-radius: 4px;"/>
                            </div>

                            <!-- All text content at the bottom center -->
                            <div class="oe_kanban_details"
                                 style="flex: 1; padding: 15px; display: flex; flex-direction: column; justify-content: flex-end; text-align: center;">

                                <!-- Title -->
                                <div class="o_kanban_record_title"
                                     style="font-weight: bold; margin-bottom: 8px; line-height: 1.3;">
                                    <field name="title"/>
                                </div>

                                <!-- Author -->
                                <div style="margin-bottom: 10px; color: #666; font-size: 0.9em;">
                                    by
                                    <field name="author"/>
                                </div>

                                <!-- Category Badge -->
                                <div style="margin-bottom: 10px;">
                                    <span class="badge" t-att-class="'badge-' + (record.category.raw_value == 'fiction' ? 'info' :
                                                               record.category.raw_value == 'science' ? 'success' :
                                                               record.category.raw_value == 'history' ? 'warning' :
                                                               record.category.raw_value == 'technology' ? 'primary' : 'secondary')">
                                        <field name="category"/>
                                    </span>
                                </div>

                                <!-- Availability Status -->
                                <div style="margin-bottom: 8px;">
                                    <span t-if="record.available_copies.raw_value > 0" class="text-success"
                                          style="font-weight: 500;">
                                        ✓ Available (<t t-esc="record.available_copies.value"/>/<t
                                            t-esc="record.total_copies.value"/>)
                                    </span>
                                    <span t-if="record.available_copies.raw_value == 0" class="text-danger"
                                          style="font-weight: 500;">
                                        ✗ Unavailable
                                    </span>
                                </div>

                                <!-- Progress Bar -->
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar" role="progressbar"
                                         t-att-style="'width: ' + (record.available_copies.raw_value / record.total_copies.raw_value * 100) + '%'"
                                         t-att-class="record.available_copies.raw_value > 0 ? 'bg-success' : 'bg-danger'">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </t>
                </templates>
            </kanban>
        </field>
    </record>
    <!-- Kanban view of library.book model (end)-->

    <!-- Search view of library.book model (start)-->
    <record id="library_book_search_view" model="ir.ui.view">
        <field name="name">Library Book Search View</field>
        <field name="model">library.book</field>
        <field name="arch" type="xml">
            <search>
                <field name="title" string="Title"/>
                <field name="author" string="Author"/>
                <field name="isbn" string="ISBN"/>

                <filter string="Available Books" name="available_books"
                        domain="[('available_copies', '>', 0)]"/>
                <filter string="Unavailable Books" name="unavailable_books"
                        domain="[('available_copies', '=', 0)]"/>

                <separator/>

                <filter string="Fiction" name="fiction"
                        domain="[('category', '=', 'fiction')]"/>
                <filter string="Science" name="science"
                        domain="[('category', '=', 'science')]"/>
                <filter string="History" name="history"
                        domain="[('category', '=', 'history')]"/>
                <filter string="Technology" name="technology"
                        domain="[('category', '=', 'technology')]"/>
                <filter string="Biography" name="biography"
                        domain="[('category', '=', 'biography')]"/>
                <filter string="Non-Fiction" name="non_fiction"
                        domain="[('category', '=', 'non_fiction')]"/>

                <separator/>

                <group expand="0" string="Group By">
                    <filter string="Category" name="group_by_category"
                            context="{'group_by': 'category'}"/>
                    <filter string="Author" name="group_by_author"
                            context="{'group_by': 'author'}"/>
                    <filter string="Publisher" name="group_by_publisher"
                            context="{'group_by': 'publisher'}"/>
                    <filter string="Publication Year" name="group_by_year"
                            context="{'group_by': 'publication_year'}"/>
                </group>
            </search>
        </field>
    </record>
    <!-- Search view of library.book model (end)-->

    <!-- Action of library.book model (start)-->
    <record id="library_book_action" model="ir.actions.act_window">
        <field name="name">Books</field>
        <field name="res_model">library.book</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="view_mode">kanban,list,form</field>
        <field name="search_view_id" ref="library_book_search_view"/>
        <field name="context">{'search_default_available_books': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Add your first book to the library!
            </p>
            <p>
                Start building your library collection by adding books with their details,
                cover images, and inventory information.
            </p>
        </field>
    </record>
    <!-- Action of library.book model (end)-->

</odoo>